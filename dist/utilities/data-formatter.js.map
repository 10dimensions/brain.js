{"version":3,"sources":["../../src/utilities/data-formatter.js"],"names":["DataFormatter","values","maxThreshold","undefined","indexTable","characterTable","characters","buildCharactersFromIterable","buildTables","tempCharactersTable","dataFormatterIndex","dataFormatterLength","length","hasOwnProperty","characterIndex","charactersLength","character","push","value","result","i","max","index","Error","value1","value2","toIndexes","split","concat","indices","toCharacters","join","addSpecial","special","specialIndex","JSON","stringify","toString","replace","toIndexesInputOutput","String","fromCharCode","dataFormatter","fromAllPrintable","addInputOutput","string","prototype","Set","array","filter","v","a","indexOf","sort","json"],"mappings":";;;;;;;;;;;;AAAA;;;;;;IAMqBA,a;AACnB,yBAAYC,MAAZ,EAAsC;AAAA,QAAlBC,YAAkB,uEAAH,CAAG;;AAAA;;AACpC,QAAID,WAAWE,SAAf,EAA0B;;AAE1B,SAAKF,MAAL,GAAcA,MAAd;AACA;AACA;AACA,SAAKG,UAAL,GAAkB,EAAlB;AACA,SAAKC,cAAL,GAAsB,EAAtB;AACA,SAAKC,UAAL,GAAkB,EAAlB;AACA,SAAKC,2BAAL,CAAiCN,MAAjC;AACA,SAAKO,WAAL,CAAiBN,YAAjB;AACD;;;;gDAE2BD,M,EAAQ;AAClC,UAAIQ,sBAAsB,EAA1B;AACA,WAAK,IAAIC,qBAAqB,CAAzB,EAA4BC,sBAAsBV,OAAOW,MAA9D,EAAsEF,qBAAqBC,mBAA3F,EAAgHD,oBAAhH,EAAsI;AACpI,YAAIJ,aAAaL,OAAOS,kBAAP,CAAjB;;AAEA,YAAIJ,WAAWO,cAAX,CAA0B,QAA1B,CAAJ,EAAyC;AACvC,eAAK,IAAIC,iBAAiB,CAArB,EAAwBC,mBAAmBT,WAAWM,MAA3D,EAAmEE,iBAAiBC,gBAApF,EAAsGD,gBAAtG,EAAwH;AACtH,gBAAIE,YAAYV,WAAWQ,cAAX,CAAhB;AACA,gBAAIL,oBAAoBI,cAApB,CAAmCG,SAAnC,CAAJ,EAAmD;AACnDP,gCAAoBO,SAApB,IAAiC,IAAjC;AACA,iBAAKV,UAAL,CAAgBW,IAAhB,CAAqBD,SAArB;AACD;AACF,SAPD,MAOO;AACL,cAAIA,aAAYf,OAAOS,kBAAP,CAAhB;AACA,cAAID,oBAAoBI,cAApB,CAAmCG,UAAnC,CAAJ,EAAmD;AACnDP,8BAAoBC,kBAApB,IAA0C,IAA1C;AACA,eAAKJ,UAAL,CAAgBW,IAAhB,CAAqBD,UAArB;AACD;AACF;AACF;;;gCAEWd,Y,EAAc;AACxB;AACA,UAAIa,mBAAmB,KAAKT,UAAL,CAAgBM,MAAvC;AACA,WAAI,IAAIE,iBAAiB,CAAzB,EAA4BA,iBAAiBC,gBAA7C,EAA+DD,gBAA/D,EAAiF;AAC/E,YAAIE,YAAY,KAAKV,UAAL,CAAgBQ,cAAhB,CAAhB;AACA,YAAGA,kBAAkBZ,YAArB,EAAmC;AACjC;AACA,eAAKE,UAAL,CAAgBY,SAAhB,IAA6BF,cAA7B;AACA,eAAKT,cAAL,CAAoBS,cAApB,IAAsCE,SAAtC;AACD;AACF;AACF;;;8BAESE,K,EAAyB;AAAA,UAAlBhB,YAAkB,uEAAH,CAAG;;AACjC,UAAIiB,SAAS,EAAb;AACA,UAAIf,aAAa,KAAKA,UAAtB;;AAEA,WAAK,IAAIgB,IAAI,CAAR,EAAWC,MAAMH,MAAMN,MAA5B,EAAoCQ,IAAIC,GAAxC,EAA6CD,GAA7C,EAAkD;AAChD,YAAIJ,YAAYE,MAAME,CAAN,CAAhB;AACA,YAAIE,QAAQlB,WAAWY,SAAX,CAAZ;AACA,YAAIM,UAAUnB,SAAd,EAAyB;AACvB,cAAIC,WAAW,cAAX,CAAJ,EAAgC;AAC9BkB,oBAAQlB,WAAW,cAAX,CAAR;AACD,WAFD,MAEO;AACL,kBAAM,IAAImB,KAAJ,8BAAsCP,SAAtC,OAAN;AACD;AACF;AACD,YAAIM,QAAQpB,YAAZ,EAA0B;AAC1BiB,eAAOF,IAAP,CAAYK,KAAZ;AACD;;AAED,aAAOH,MAAP;AACD;;;yCAEoBK,M,EAAyC;AAAA,UAAjCC,MAAiC,uEAAxB,IAAwB;AAAA,UAAlBvB,YAAkB,uEAAH,CAAG;;AAC5D,UAAIiB,eAAJ;AACA,UAAI,OAAOK,MAAP,KAAkB,QAAtB,EAAgC;AAC9BL,iBAAS,KAAKO,SAAL,CAAeF,OAAOG,KAAP,CAAa,EAAb,EAAiBC,MAAjB,CAAwB,CAAC,YAAD,EAAe,cAAf,CAAxB,CAAf,EAAwE1B,YAAxE,CAAT;AACD,OAFD,MAEO;AACLiB,iBAAS,KAAKO,SAAL,CAAeF,OAAOI,MAAP,CAAc,CAAC,YAAD,EAAe,cAAf,CAAd,CAAf,EAA8D1B,YAA9D,CAAT;AACD;;AAED,UAAIuB,WAAW,IAAf,EAAqB,OAAON,MAAP;;AAErB,UAAI,OAAOM,MAAP,KAAkB,QAAtB,EAAgC;AAC9B,eAAON,OAAOS,MAAP,CAAc,KAAKF,SAAL,CAAeD,OAAOE,KAAP,CAAa,EAAb,CAAf,EAAiCzB,YAAjC,CAAd,CAAP;AACD,OAFD,MAEO;AACL,eAAOiB,OAAOS,MAAP,CAAc,KAAKF,SAAL,CAAeD,MAAf,EAAuBvB,YAAvB,CAAd,CAAP;AACD;AACF;;;iCAEY2B,O,EAA2B;AAAA,UAAlB3B,YAAkB,uEAAH,CAAG;;AACtC,UAAMiB,SAAS,EAAf;AACA,UAAMd,iBAAiB,KAAKA,cAA5B;AACA,UAAMD,aAAa,KAAKA,UAAxB;;AAEA,WAAK,IAAIgB,IAAI,CAAR,EAAWC,MAAMQ,QAAQjB,MAA9B,EAAsCQ,IAAIC,GAA1C,EAA+CD,GAA/C,EAAoD;AAClD,YAAIE,QAAQO,QAAQT,CAAR,CAAZ;AACA,YAAIE,QAAQpB,YAAZ,EAA0B;AAC1B,YAAIc,YAAYX,eAAeiB,KAAf,CAAhB;AACA,YAAIN,cAAcb,SAAlB,EAA6B;AAC3B,cAAIC,WAAW,cAAX,CAAJ,EAAgC;AAC9BY,wBAAYX,eAAeD,WAAW,cAAX,CAAf,CAAZ;AACD,WAFD,MAEO;AACL,kBAAM,IAAImB,KAAJ,0BAAkCD,KAAlC,OAAN;AACD;AACF,SAND,MAMO,IAAIN,cAAc,IAAlB,EAAwB;AAC7BG,iBAAOF,IAAP,CAAYD,SAAZ;AACD;AACF;;AAED,aAAOG,MAAP;AACD;;;6BAEQU,O,EAAS3B,Y,EAAc;AAC9B,aAAO,KAAK4B,YAAL,CAAkBD,OAAlB,EAA2B3B,YAA3B,EAAyC6B,IAAzC,CAA8C,EAA9C,CAAP;AACD;;;qCAEgB;AACf,WAAKC,UAAL,CAAgB,YAAhB;AACA,WAAKA,UAAL,CAAgB,cAAhB;AACD;;;sCAEiB;AAChB,WAAKA,UAAL,CAAgB,cAAhB;AACD;;;+BA0CUC,O,EAA2B;AAAA,UAAlBjB,SAAkB,uEAAN,IAAM;;AACpC,UAAIkB,eAAe,KAAK9B,UAAL,CAAgB6B,OAAhB,IAA2B,KAAK3B,UAAL,CAAgBM,MAA9D;AACA,WAAKP,cAAL,CAAoB6B,YAApB,IAAoClB,SAApC;AACA,WAAKV,UAAL,CAAgBW,IAAhB,CAAqBgB,OAArB;AACD;;;uCAEkB;AACjB,yCACoBE,KAAKC,SAAL,CAAe,KAAK/B,cAApB,CADpB,4BAEgB8B,KAAKC,SAAL,CAAe,KAAKhC,UAApB,CAFhB,4BAGgB+B,KAAKC,SAAL,CAAe,KAAK9B,UAApB,CAHhB,WAID,KAAKoB,SAAL,CAAeW,QAAf,GACIC,OADJ,CACY,6CADZ,EAC2D,EAD3D,EAEIA,OAFJ,CAEY,UAFZ,EAEwB,EAFxB,CAJC,UAOD,KAAKC,oBAAL,CAA0BF,QAA1B,GAAqCC,OAArC,CAA6C,UAA7C,EAAyD,EAAzD,CAPC,UAQD,KAAKR,YAAL,CAAkBO,QAAlB,GACIC,OADJ,CACY,sDADZ,EACoE,EADpE,EAEIA,OAFJ,CAEY,SAFZ,EAEuB,EAFvB,CARC;AAYD;;;qCA3DuBpC,Y,EAA+B;AAAA,UAAjBD,MAAiB,uEAAR,CAAC,IAAD,CAAQ;;AACrD,WAAI,IAAImB,IAAI,EAAZ,EAAgBA,KAAK,GAArB,EAA0BA,GAA1B,EAA+B;AAC7BnB,eAAOgB,IAAP,CAAYuB,OAAOC,YAAP,CAAoBrB,CAApB,CAAZ;AACD;AACD,aAAO,IAAIpB,aAAJ,CAAkBC,MAAlB,EAA0BC,YAA1B,CAAP;AACD;;;gDAEkCA,Y,EAA+B;AAAA,UAAjBD,MAAiB,uEAAR,CAAC,IAAD,CAAQ;;AAChE,UAAMyC,gBAAgB1C,cAAc2C,gBAAd,CAA+BzC,YAA/B,EAA6CD,MAA7C,CAAtB;AACAyC,oBAAcE,cAAd;AACA,aAAOF,aAAP;AACD;;;0CAE4BG,M,EAAQ3C,Y,EAAc;AAAA;;AACjD,UAAMD,SAAS,4BAAO6C,SAAP,EAAiBlB,MAAjB,6CAA2B,IAAImB,GAAJ,CAAQF,MAAR,CAA3B,EAAf;AACA,UAAMH,gBAAgB,IAAI1C,aAAJ,CAAkBC,MAAlB,EAA0BC,YAA1B,CAAtB;AACAwC,oBAAcE,cAAd;AACA,aAAOF,aAAP;AACD;;;yCAE2BM,K,EAAO9C,Y,EAAc;AAC/C,UAAMwC,gBAAgB,IAAI1C,aAAJ,CAAkBgD,MAAMC,MAAN,CAAa,UAACC,CAAD,EAAI9B,CAAJ,EAAO+B,CAAP;AAAA,eAAaA,EAAEC,OAAF,CAAUF,CAAV,MAAiB9B,CAA9B;AAAA,OAAb,EAA8CiC,IAA9C,EAAlB,EAAwEnD,YAAxE,CAAtB;AACAwC,oBAAcE,cAAd;AACA,aAAOF,aAAP;AACD;;;+BAEiBG,M,EAAQ3C,Y,EAAc;AAAA;;AACtC,UAAMD,SAAS,6BAAO6C,SAAP,EAAiBlB,MAAjB,8CAA2B,IAAImB,GAAJ,CAAQF,MAAR,CAA3B,EAAf;AACA,aAAO,IAAI7C,aAAJ,CAAkBC,MAAlB,EAA0BC,YAA1B,CAAP;AACD;;;6BAEeoD,I,EAAM;AACpB,UAAMZ,gBAAgB,IAAI1C,aAAJ,EAAtB;AACA0C,oBAActC,UAAd,GAA2BkD,KAAKlD,UAAhC;AACAsC,oBAAcrC,cAAd,GAA+BiD,KAAKjD,cAApC;AACAqC,oBAAczC,MAAd,GAAuBqD,KAAKrD,MAA5B;AACAyC,oBAAcpC,UAAd,GAA2BgD,KAAKhD,UAAhC;AACA,aAAOoC,aAAP;AACD;;;;;;kBAhKkB1C,a","file":"data-formatter.js","sourcesContent":["/**\n *\n * @param {String[]|Number[]} values\n * @param maxThreshold\n * @constructor\n */\nexport default class DataFormatter {\n  constructor(values, maxThreshold = 0) {\n    if (values === undefined) return;\n\n    this.values = values;\n    // go over all characters and keep track of all unique ones seen\n    // count up all characters\n    this.indexTable = {};\n    this.characterTable = {};\n    this.characters = [];\n    this.buildCharactersFromIterable(values);\n    this.buildTables(maxThreshold);\n  }\n\n  buildCharactersFromIterable(values) {\n    let tempCharactersTable = {};\n    for (let dataFormatterIndex = 0, dataFormatterLength = values.length; dataFormatterIndex < dataFormatterLength; dataFormatterIndex++) {\n      let characters = values[dataFormatterIndex];\n\n      if (characters.hasOwnProperty('length')) {\n        for (let characterIndex = 0, charactersLength = characters.length; characterIndex < charactersLength; characterIndex++) {\n          let character = characters[characterIndex];\n          if (tempCharactersTable.hasOwnProperty(character)) continue;\n          tempCharactersTable[character] = true;\n          this.characters.push(character);\n        }\n      } else {\n        let character = values[dataFormatterIndex];\n        if (tempCharactersTable.hasOwnProperty(character)) continue;\n        tempCharactersTable[dataFormatterIndex] = true;\n        this.characters.push(character);\n      }\n    }\n  }\n\n  buildTables(maxThreshold) {\n    // filter by count threshold and create pointers\n    let charactersLength = this.characters.length;\n    for(let characterIndex = 0; characterIndex < charactersLength; characterIndex++) {\n      let character = this.characters[characterIndex];\n      if(characterIndex >= maxThreshold) {\n        // add character to dataFormatter\n        this.indexTable[character] = characterIndex;\n        this.characterTable[characterIndex] = character;\n      }\n    }\n  }\n\n  toIndexes(value, maxThreshold = 0) {\n    let result = [];\n    let indexTable = this.indexTable;\n\n    for (let i = 0, max = value.length; i < max; i++) {\n      let character = value[i];\n      let index = indexTable[character];\n      if (index === undefined) {\n        if (indexTable['unrecognized']) {\n          index = indexTable['unrecognized'];\n        } else {\n          throw new Error(`unrecognized character \"${ character }\"`);\n        }\n      }\n      if (index < maxThreshold) continue;\n      result.push(index);\n    }\n\n    return result;\n  }\n\n  toIndexesInputOutput(value1, value2 = null, maxThreshold = 0) {\n    let result;\n    if (typeof value1 === 'string') {\n      result = this.toIndexes(value1.split('').concat(['stop-input', 'start-output']), maxThreshold);\n    } else {\n      result = this.toIndexes(value1.concat(['stop-input', 'start-output']), maxThreshold);\n    }\n    \n    if (value2 === null) return result;\n\n    if (typeof value2 === 'string') {\n      return result.concat(this.toIndexes(value2.split(''), maxThreshold));\n    } else {\n      return result.concat(this.toIndexes(value2, maxThreshold));\n    }\n  }\n\n  toCharacters(indices, maxThreshold = 0) {\n    const result = [];\n    const characterTable = this.characterTable;\n    const indexTable = this.indexTable;\n\n    for (let i = 0, max = indices.length; i < max; i++) {\n      let index = indices[i];\n      if (index < maxThreshold) continue;\n      let character = characterTable[index];\n      if (character === undefined) {\n        if (indexTable['unrecognized']) {\n          character = characterTable[indexTable['unrecognized']];\n        } else {\n          throw new Error(`unrecognized index \"${ index }\"`);\n        }\n      } else if (character !== null) {\n        result.push(character);\n      }\n    }\n\n    return result;\n  }\n\n  toString(indices, maxThreshold) {\n    return this.toCharacters(indices, maxThreshold).join('');\n  }\n\n  addInputOutput() {\n    this.addSpecial('stop-input');\n    this.addSpecial('start-output');\n  }\n\n  addUnrecognized() {\n    this.addSpecial('unrecognized');\n  }\n\n  static fromAllPrintable(maxThreshold, values = ['\\n']) {\n    for(let i = 32; i <= 126; i++) {\n      values.push(String.fromCharCode(i));\n    }\n    return new DataFormatter(values, maxThreshold);\n  }\n\n  static fromAllPrintableInputOutput(maxThreshold, values = ['\\n']) {\n    const dataFormatter = DataFormatter.fromAllPrintable(maxThreshold, values);\n    dataFormatter.addInputOutput();\n    return dataFormatter;\n  }\n\n  static fromStringInputOutput(string, maxThreshold) {\n    const values = String.prototype.concat(...new Set(string));\n    const dataFormatter = new DataFormatter(values, maxThreshold);\n    dataFormatter.addInputOutput();\n    return dataFormatter;\n  }\n\n  static fromArrayInputOutput(array, maxThreshold) {\n    const dataFormatter = new DataFormatter(array.filter((v, i, a) => a.indexOf(v) === i).sort(), maxThreshold);\n    dataFormatter.addInputOutput();\n    return dataFormatter;\n  }\n\n  static fromString(string, maxThreshold) {\n    const values = String.prototype.concat(...new Set(string));\n    return new DataFormatter(values, maxThreshold);\n  }\n\n  static fromJSON(json) {\n    const dataFormatter = new DataFormatter();\n    dataFormatter.indexTable = json.indexTable;\n    dataFormatter.characterTable = json.characterTable;\n    dataFormatter.values = json.values;\n    dataFormatter.characters = json.characters;\n    return dataFormatter;\n  }\n\n  addSpecial(special, character = null) {\n    let specialIndex = this.indexTable[special] = this.characters.length;\n    this.characterTable[specialIndex] = character;\n    this.characters.push(special);\n  }\n\n  toFunctionString() {\n    return `\nvar characterTable = ${ JSON.stringify(this.characterTable) };\nvar indexTable = ${ JSON.stringify(this.indexTable) };\nvar characters = ${ JSON.stringify(this.characters) };\n${ this.toIndexes.toString()\n      .replace(/(let|var) indexTable = this[.]indexTable;\\n/, '')\n      .replace(/this[.]/g, '') }\n${ this.toIndexesInputOutput.toString().replace(/this[.]/g, '') }\n${ this.toCharacters.toString()\n      .replace(/(let|var) characterTable = this[.]characterTable;\\n/g, '')\n      .replace(/this[.]/, '') }\n`;\n  }\n}\n"]}