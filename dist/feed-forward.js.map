{"version":3,"sources":["../src/feed-forward.js"],"names":["praxis","FeedForward","log","trainOpts","console","opts","Object","keys","constructor","trainDefaults","forEach","opt","hasOwnProperty","_validateTrainingOptions","_setLogMethod","options","validations","iterations","val","errorThresh","logPeriod","learningRate","callback","callbackPeriod","timeout","key","Error","reinforce","binaryThresh","hiddenLayers","inputLayer","outputLayer","layer","momentumRootMeanSquaredPropagation","layers","_inputLayer","_outputLayer","errorCheckInterval","assign","defaults","_updateTrainingOptions","structure","_connectHiddenLayers","length","push","apply","previousLayer","i","hiddenLayer","_connectLayers","initializeLayers","setupKernels","input","inputLookup","toArray","output","runInput","outputLookup","toHash","predict","weights","data","status","endTime","_prepTraining","_trainingTick","error","Date","now","_calculateTrainingError","_trainPatterns","_formatData","initialize","sum","_trainPattern","target","logErrorRate","_calculateDeltas","_adjustWeights","errors","compare","nextLayer","learn","Array","isArray","tmp","datum","Float32Array","buildLookup","map","value","array","jsonLayers","jsonLayer","toJSON","inputLayerIndex","indexOf","inputLayer1Index","inputLayer1","inputLayer2Index","inputLayer2","json","getLayer","undefined","net"],"mappings":"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","file":"feed-forward.js","sourcesContent":["import lookup from './lookup';\nimport TrainStream from './train-stream';\nimport mse2d from './utilities/mse-2d';\nimport layerFromJSON from './utilities/layer-from-json';\nimport * as praxis from './praxis';\nimport flattenLayers from './utilities/flatten-layers';\n\nexport default class FeedForward {\n  static get trainDefaults() {\n    return {\n      iterations: 20000,\n      errorThresh: 0.005,\n      log: false,\n      logPeriod: 10,\n      learningRate: 0.3,\n      callback: null,\n      callbackPeriod: 10,\n      reinforce: false\n    };\n  }\n\n  static get defaults() {\n    return {\n      learningRate: 0.3,\n      binaryThresh: 0.5,\n      hiddenLayers: null,\n      inputLayer: null,\n      outputLayer: null,\n      praxis: (layer) => praxis.momentumRootMeanSquaredPropagation(layer)\n    };\n  }\n\n  /**\n   *\n   * @param options\n   * @private\n   */\n  static _validateTrainingOptions(options) {\n    const validations = {\n      iterations: (val) => { return typeof val === 'number' && val > 0; },\n      errorThresh: (val) => { return typeof val === 'number' && val > 0 && val < 1; },\n      log: (val) => { return typeof val === 'function' || typeof val === 'boolean'; },\n      logPeriod: (val) => { return typeof val === 'number' && val > 0; },\n      learningRate: (val) => { return typeof val === 'number' && val > 0 && val < 1; },\n      callback: (val) => { return typeof val === 'function' || val === null },\n      callbackPeriod: (val) => { return typeof val === 'number' && val > 0; },\n      timeout: (val) => { return typeof val === 'number' && val > 0 }\n    };\n    Object.keys(FeedForward.trainDefaults).forEach(key => {\n      if (validations.hasOwnProperty(key) && !validations[key](options[key])) {\n        throw new Error(`[${key}, ${options[key]}] is out of normal training range, your network will probably not train.`);\n      }\n    });\n  }\n\n  /**\n   *\n   * @param log\n   * if a method is passed in method is used\n   * if false passed in nothing is logged\n   * @returns error\n   */\n  _setLogMethod(log) {\n    if (typeof log === 'function'){\n      this.trainOpts.log = log;\n    } else if (log) {\n      this.trainOpts.log = console.log;\n    } else {\n      this.trainOpts.log = false;\n    }\n  }\n\n  /**\n   *\n   * @param opts\n   *    Supports all `trainDefaults` properties\n   *    also supports:\n   *       learningRate: (number)\n   */\n  _updateTrainingOptions(opts) {\n    Object.keys(this.constructor.trainDefaults).forEach(opt => this.trainOpts[opt] = (opts.hasOwnProperty(opt)) ? opts[opt] : this.trainOpts[opt]);\n    this.constructor._validateTrainingOptions(this.trainOpts);\n    this._setLogMethod(opts.log || this.trainOpts.log);\n  }\n\n  static get structure() {\n    return {\n      layers: null,\n      _inputLayer: null,\n      _outputLayer: null\n    };\n  }\n  /**\n   *\n   * @param {object} options\n   * @constructor\n   */\n  constructor(options = {}) {\n    this.inputLayer = null;\n    this.hiddenLayers = null;\n    this.outputLayer = null;\n    this.errorCheckInterval = 100;\n    Object.assign(this, this.constructor.defaults, options);\n    this.trainOpts = {};\n    this._updateTrainingOptions(Object.assign({}, this.constructor.trainDefaults, options));\n    Object.assign(this, this.constructor.structure);\n  }\n\n  _connectLayers() {\n    const layers = [];\n    this._inputLayer = this.inputLayer();\n    const hiddenLayers = this._connectHiddenLayers(this._inputLayer);\n    this._outputLayer = this.outputLayer(hiddenLayers[hiddenLayers.length - 1], hiddenLayers.length);\n    layers.push(this._inputLayer);\n    layers.push.apply(layers, hiddenLayers);\n    layers.push(this._outputLayer);\n    this.layers = flattenLayers(layers);\n  }\n\n  _connectHiddenLayers(previousLayer) {\n    const hiddenLayers = [];\n    for (let i = 0; i < this.hiddenLayers.length; i++) {\n      const hiddenLayer = this.hiddenLayers[i](previousLayer, i);\n      hiddenLayers.push(hiddenLayer);\n      previousLayer = hiddenLayer;\n    }\n    return hiddenLayers;\n  }\n\n  initialize() {\n    this._connectLayers();\n    this.initializeLayers(this.layers);\n  }\n\n  initializeLayers(layers) {\n    for (let i = 0; i < layers.length; i++) {\n      const layer = layers[i];\n      layer.setupKernels();\n      if (layer.hasOwnProperty('praxis') && layer.praxis === null) {\n        layer.praxis = this.praxis(layer);\n      }\n    }\n  }\n\n  /**\n   *\n   * @param input\n   * @returns {*}\n   */\n  run(input) {\n    if (this.inputLookup) {\n      input = lookup.toArray(this.inputLookup, input);\n    }\n\n    let output = this.runInput(input);\n\n    if (this.outputLookup) {\n      output = lookup.toHash(this.outputLookup, output);\n    }\n    return output;\n  }\n\n  runInput(input) {\n    this.layers[0].predict(input);\n    for (let i = 1; i < this.layers.length; i++) {\n      this.layers[i].predict();\n    }\n    return this.layers[this.layers.length - 1].weights;\n  }\n\n  /**\n   *\n   * @param data\n   * @param options\n   * @returns {{error: number, iterations: number}}\n   */\n  train(data, options = {}) {\n    let status, endTime;\n    ({ data, status, endTime } = this._prepTraining(data, options));\n\n    while (this._trainingTick(data, status, endTime));\n    return status;\n  }\n\n  /**\n   *\n   * @param {object} data\n   * @param {object} status { iterations: number, error: number }\n   * @param endTime\n   */\n  _trainingTick(data, status, endTime) {\n    if (status.iterations >= this.trainOpts.iterations || status.error <= this.trainOpts.errorThresh || Date.now() >= endTime) {\n      return false;\n    }\n\n    status.iterations++;\n\n    if (this.trainOpts.log && (status.iterations % this.trainOpts.logPeriod === 0)) {\n      status.error = this._calculateTrainingError(data);\n      this.trainOpts.log(`iterations: ${status.iterations}, training error: ${status.error}`);\n    } else {\n      if (status.iterations % this.errorCheckInterval === 0) {\n        status.error = this._calculateTrainingError(data);\n      } else {\n        this._trainPatterns(data);\n      }\n    }\n\n    if (this.trainOpts.callback && (status.iterations % this.trainOpts.callbackPeriod === 0)) {\n      this.trainOpts.callback(Object.assign(status));\n    }\n    return true;\n  }\n\n  /**\n   *\n   * @param data\n   * @param options\n   * @protected\n   * @return { data, status, endTime }\n   */\n  _prepTraining(data, options) {\n    this._updateTrainingOptions(options);\n    data = this._formatData(data);\n    const endTime = Date.now() + this.trainOpts.timeout;\n\n    const status = {\n      error: 1,\n      iterations: 0\n    };\n\n    this.initialize();\n\n    return {\n      data,\n      status,\n      endTime\n    };\n  }\n\n  /**\n   *\n   * @param data\n   * @returns {Number} error\n   */\n  _calculateTrainingError(data) {\n    let sum = 0;\n    for (let i = 0; i < data.length; ++i) {\n      sum += this._trainPattern(data[i].input, data[i].output, true);\n    }\n    return sum / data.length;\n  }\n\n  /**\n   * @param data\n   * @private\n   */\n  _trainPatterns(data) {\n    for (let i = 0; i < data.length; ++i) {\n      this._trainPattern(data[i].input, data[i].output, false);\n    }\n  }\n\n  /**\n   *\n   * @param input\n   * @param target\n   * @param {Boolean} logErrorRate\n   */\n  _trainPattern(input, target, logErrorRate) {\n\n    // forward propagate\n    this.runInput(input);\n\n    // back propagate\n    this._calculateDeltas(target);\n    this._adjustWeights();\n\n    if (logErrorRate) {\n      return mse2d(this._outputLayer.errors.hasOwnProperty('toArray') ? this._outputLayer.errors.toArray() : this._outputLayer.errors);\n    } else {\n      return null\n    }\n  }\n\n  _calculateDeltas(target) {\n    this._outputLayer.compare(target);\n    for (let i = this.layers.length - 2; i > -1; i--) {\n      const previousLayer = this.layers[i - 1];\n      const nextLayer = this.layers[i + 1];\n      this.layers[i].compare(previousLayer, nextLayer);\n    }\n  }\n\n  /**\n   *\n   */\n  _adjustWeights() {\n    for (let i = 0; i < this.layers.length; i++) {\n      this.layers[i].learn(this.layers[i-1], this.layers[i+1], this.trainOpts.learningRate);\n    }\n  }\n\n  /**\n   *\n   * @param data\n   * @returns {*}\n   */\n  _formatData(data) {\n    if (!Array.isArray(data)) { // turn stream datum into array\n      let tmp = [];\n      tmp.push(data);\n      data = tmp;\n    }\n    // turn sparse hash input into arrays with 0s as filler\n    let datum = data[0].input;\n    if (!Array.isArray(datum) && !(datum instanceof Float32Array)) {\n      if (!this.inputLookup) {\n        this.inputLookup = lookup.buildLookup(data.map(value => value['input']));\n      }\n      data = data.map(datum => {\n        let array = lookup.toArray(this.inputLookup, datum.input);\n        return Object.assign({}, datum, { input: array });\n      }, this);\n    }\n\n    if (!Array.isArray(data[0].output)) {\n      if (!this.outputLookup) {\n        this.outputLookup = lookup.buildLookup(data.map(value => value['output']));\n      }\n      data = data.map(datum => {\n        let array = lookup.toArray(this.outputLookup, datum.output);\n        return Object.assign({}, datum, { output: array });\n      }, this);\n    }\n    return data;\n  }\n\n  /**\n   *\n   * @param data\n   * @returns {\n   *  {\n   *    error: number,\n   *    misclasses: Array\n   *  }\n   * }\n   */\n  test(data) {\n    /* istanbul ignore next */\n    throw new Error('not yet implemented');\n  }\n\n  /**\n   *\n   */\n  toJSON() {\n    const jsonLayers = [];\n    for (let i = 0; i < this.layers.length; i++) {\n      const layer = this.layers[i];\n      const jsonLayer = layer.toJSON();\n      if (layer.hasOwnProperty('inputLayer')) {\n        jsonLayer.inputLayerIndex = this.layers.indexOf(layer.inputLayer);\n      } else {\n        if (layer.hasOwnProperty('inputLayer1') && layer.hasOwnProperty('inputLayer2')) {\n          jsonLayer.inputLayer1Index = this.layers.indexOf(layer.inputLayer1);\n          jsonLayer.inputLayer2Index = this.layers.indexOf(layer.inputLayer2);\n        }\n      }\n      jsonLayers.push(jsonLayer);\n    }\n    return  {\n      layers: jsonLayers\n    };\n  }\n\n  /**\n   *\n   * @param json\n   * @param [getLayer]\n   * @returns {FeedForward}\n   */\n  static fromJSON(json, getLayer) {\n    const jsonLayers = json.layers;\n    const layers = [];\n    const inputLayer = layerFromJSON(jsonLayers[0]) || getLayer(jsonLayers[0]);\n    layers.push(inputLayer);\n    for (let i = 1; i < jsonLayers.length; i++) {\n      const jsonLayer = jsonLayers[i];\n      if (jsonLayer.hasOwnProperty('inputLayerIndex')) {\n        const inputLayer = layers[jsonLayer.inputLayerIndex];\n        layers.push(layerFromJSON(jsonLayer, inputLayer) || getLayer(jsonLayer, inputLayer));\n      } else {\n        if (!jsonLayer.hasOwnProperty('inputLayer1Index')) throw new Error('inputLayer1Index not defined');\n        if (!jsonLayer.hasOwnProperty('inputLayer2Index')) throw new Error('inputLayer2Index not defined');\n        const inputLayer1 = layers[jsonLayer.inputLayer1Index];\n        const inputLayer2 = layers[jsonLayer.inputLayer2Index];\n\n        if (inputLayer1 === undefined) throw new Error(`layer of index ${jsonLayer.inputLayer1Index} not found`);\n        if (inputLayer2 === undefined) throw new Error(`layer of index ${jsonLayer.inputLayer2Index} not found`);\n\n        layers.push(layerFromJSON(jsonLayer, inputLayer) || getLayer(jsonLayer, inputLayer1, inputLayer2));\n      }\n    }\n\n    const net = new FeedForward(json);\n    net.layers = layers;\n    return net;\n  }\n\n  /**\n   *\n   * @returns {Function}\n   */\n  toFunction() {\n    /* istanbul ignore next */\n    throw new Error('not yet implemented');\n  }\n\n  /**\n   * This will create a TrainStream (WriteStream) for us to send the training data to.\n   * @param opts training options\n   * @returns {TrainStream|*}\n   */\n  createTrainStream(opts) {\n    /* istanbul ignore next */\n    throw new Error('not yet implemented');\n  }\n}"]}