{"version":3,"sources":["../../src/praxis/momentum-root-mean-squared-propagation.js"],"names":["clipByValue","isClippedByValue","MomentumRootMeanSquaredPropagation","decayRate","regularizationStrength","learningRate","smoothEps","clipValue","layer","settings","width","height","momentums","Object","assign","constructor","defaults","setupKernels","previousLayer","nextLayer","output","kernel","weights","deltas","result","momentumRootMeanSquaredPropagation","constants","functions","map","getMomentum","MRmsProp","previousMomentums","delta","thread","y","x","clippedDelta","weight","previousMomentum","momentum","Math","sqrt","decay","value","max","min"],"mappings":"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","file":"momentum-root-mean-squared-propagation.js","sourcesContent":["import makeKernel from '../utilities/make-kernel';\nimport zeros2D from '../utilities/zeros-2d';\n\nexport default class MomentumRootMeanSquaredPropagation {\n  static get defaults() {\n    return {\n      decayRate: 0.999,\n      regularizationStrength: 0.000001,\n      learningRate: 0.01,\n      smoothEps: 1e-8,\n      clipValue: 5\n    };\n  }\n\n  constructor(layer, settings = {}) {\n    this.layer = layer;\n    this.width = layer.width;\n    this.height = layer.height;\n    this.momentums = zeros2D(layer.width, layer.height);\n    Object.assign(this, this.constructor.defaults, settings);\n    this.setupKernels();\n  }\n\n  run(layer, previousLayer, nextLayer, learningRate) {\n    const output = this.kernel(\n      layer.weights,\n      layer.deltas,\n      this.momentums\n    );\n    this.momentums = output.momentums;\n    return output.result;\n  }\n\n  setupKernels() {\n    this.kernel = makeKernel(momentumRootMeanSquaredPropagation, {\n      output: [this.width, this.height],\n      constants: {\n        clipValue: this.clipValue,\n        decayRate: this.decayRate,\n        learningRate: this.learningRate,\n        regularizationStrength: this.regularizationStrength,\n        smoothEps: this.smoothEps\n      },\n      functions: [\n        clipByValue\n      ],\n      map: {\n        momentums: getMomentum\n      }\n    })\n  }\n}\n\n/**\n * @description Mathematician friendly name of MomentumRootMeanSquaredPropagation class. For those that are not mere mortals\n * @type {MomentumRootMeanSquaredPropagation}\n */\nconst MRmsProp = MomentumRootMeanSquaredPropagation;\n\n/**\n * @description Momentum Root Mean Square Propagation Function\n * @returns {number}\n */\nfunction momentumRootMeanSquaredPropagation(\n  weights, deltas, previousMomentums) {\n  const delta = deltas[this.thread.y][this.thread.x];\n  const clippedDelta = clipByValue(delta, this.constants.clipValue, -this.constants.clipValue);\n  const weight = weights[this.thread.y][this.thread.x];\n  const previousMomentum = previousMomentums[this.thread.y][this.thread.x];\n  const momentum = getMomentum(delta, this.constants.decayRate, previousMomentum);\n  return weight + -this.constants.learningRate * clippedDelta / Math.sqrt(momentum + this.constants.smoothEps) - this.constants.regularizationStrength * weight;\n}\n\nfunction getMomentum(delta, decay, previousMomentum) {\n  return previousMomentum * decay + (1 - decay) * delta * delta;\n}\n\nexport function clipByValue(value, max, min) {\n  if (value > max) {\n    return max;\n  }\n  if (value < min) {\n    return min;\n  }\n  return value;\n}\n\nexport function isClippedByValue(value, max, min) {\n  if (value > max) {\n    return 1;\n  }\n  if (value < min) {\n    return 1;\n  }\n  return 0;\n}\n\nexport {\n  getMomentum,\n  MRmsProp\n};\n"]}